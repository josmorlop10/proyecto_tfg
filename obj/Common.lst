                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module Common
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _set_bkg_tiles
                                     11 	.globl _wait_vbl_done
                                     12 	.globl _performantdelay
                                     13 	.globl _tileindex_from_xy
                                     14 	.globl _change_bkg_tile_xy
                                     15 	.globl _change_bkg_tile_16x16
                                     16 ;--------------------------------------------------------
                                     17 ; special function registers
                                     18 ;--------------------------------------------------------
                                     19 ;--------------------------------------------------------
                                     20 ; ram data
                                     21 ;--------------------------------------------------------
                                     22 	.area _DATA
                                     23 ;--------------------------------------------------------
                                     24 ; ram data
                                     25 ;--------------------------------------------------------
                                     26 	.area _INITIALIZED
                                     27 ;--------------------------------------------------------
                                     28 ; absolute external ram data
                                     29 ;--------------------------------------------------------
                                     30 	.area _DABS (ABS)
                                     31 ;--------------------------------------------------------
                                     32 ; global & static initialisations
                                     33 ;--------------------------------------------------------
                                     34 	.area _HOME
                                     35 	.area _GSINIT
                                     36 	.area _GSFINAL
                                     37 	.area _GSINIT
                                     38 ;--------------------------------------------------------
                                     39 ; Home
                                     40 ;--------------------------------------------------------
                                     41 	.area _HOME
                                     42 	.area _HOME
                                     43 ;--------------------------------------------------------
                                     44 ; code
                                     45 ;--------------------------------------------------------
                                     46 	.area _CODE
                                     47 ;src/Common.c:5: void performantdelay(uint8_t numloops){
                                     48 ;	---------------------------------
                                     49 ; Function performantdelay
                                     50 ; ---------------------------------
    00000000                         51 _performantdelay::
    00000000 4F               [ 4]   52 	ld	c, a
                                     53 ;src/Common.c:7: for(i = 0; i < numloops; i++){
    00000001 06 00            [ 8]   54 	ld	b, #0x00
    00000003                         55 00103$:
    00000003 78               [ 4]   56 	ld	a, b
    00000004 91               [ 4]   57 	sub	a, c
    00000005 D0               [20]   58 	ret	NC
                                     59 ;src/Common.c:8: wait_vbl_done();
    00000006 CDr00r00         [24]   60 	call	_wait_vbl_done
                                     61 ;src/Common.c:7: for(i = 0; i < numloops; i++){
    00000009 04               [ 4]   62 	inc	b
                                     63 ;src/Common.c:10: }
    0000000A 18 F7            [12]   64 	jr	00103$
                                     65 ;src/Common.c:12: uint16_t tileindex_from_xy(uint8_t x, uint8_t y){
                                     66 ;	---------------------------------
                                     67 ; Function tileindex_from_xy
                                     68 ; ---------------------------------
    0000000C                         69 _tileindex_from_xy::
    0000000C E8 FA            [16]   70 	add	sp, #-6
    0000000E F8 05            [12]   71 	ldhl	sp,	#5
    00000010 73               [ 8]   72 	ld	(hl), e
                                     73 ;src/Common.c:21: uint8_t indexBRx = (x - 8) / 8; //señala la columna
    00000011 F8 01            [12]   74 	ldhl	sp,	#1
    00000013 22               [ 8]   75 	ld	(hl+), a
    00000014 AF               [ 4]   76 	xor	a, a
    00000015 32               [ 8]   77 	ld	(hl-), a
    00000016 2A               [ 8]   78 	ld	a, (hl+)
    00000017 5F               [ 4]   79 	ld	e, a
    00000018 56               [ 8]   80 	ld	d, (hl)
    00000019 21 08 00         [12]   81 	ld	hl, #0x0008
    0000001C 7B               [ 4]   82 	ld	a, e
    0000001D 95               [ 4]   83 	sub	a, l
    0000001E 5F               [ 4]   84 	ld	e, a
    0000001F 7A               [ 4]   85 	ld	a, d
    00000020 9C               [ 4]   86 	sbc	a, h
    00000021 F8 04            [12]   87 	ldhl	sp,	#4
    00000023 32               [ 8]   88 	ld	(hl-), a
    00000024 73               [ 8]   89 	ld	(hl), e
    00000025 2A               [ 8]   90 	ld	a, (hl+)
    00000026 4F               [ 4]   91 	ld	c, a
    00000027 46               [ 8]   92 	ld	b, (hl)
    00000028 CB 7E            [12]   93 	bit	7, (hl)
    0000002A 28 0C            [12]   94 	jr	Z, 00103$
    0000002C 2B               [ 8]   95 	dec	hl
    0000002D 2B               [ 8]   96 	dec	hl
    0000002E 2B               [ 8]   97 	dec	hl
    0000002F 2A               [ 8]   98 	ld	a, (hl+)
    00000030 5F               [ 4]   99 	ld	e, a
    00000031 56               [ 8]  100 	ld	d, (hl)
    00000032 21 FF FF         [12]  101 	ld	hl, #0xffff
    00000035 19               [ 8]  102 	add	hl, de
    00000036 4D               [ 4]  103 	ld	c, l
    00000037 44               [ 4]  104 	ld	b, h
    00000038                        105 00103$:
    00000038 CB 28            [ 8]  106 	sra	b
    0000003A CB 19            [ 8]  107 	rr	c
    0000003C CB 28            [ 8]  108 	sra	b
    0000003E CB 19            [ 8]  109 	rr	c
    00000040 CB 28            [ 8]  110 	sra	b
    00000042 CB 19            [ 8]  111 	rr	c
    00000044 F8 00            [12]  112 	ldhl	sp,	#0
    00000046 71               [ 8]  113 	ld	(hl), c
                                    114 ;src/Common.c:22: uint8_t indexBRy = (y - 16) / 8; //señala la fila
    00000047 F8 05            [12]  115 	ldhl	sp,	#5
    00000049 7E               [ 8]  116 	ld	a, (hl)
    0000004A F8 01            [12]  117 	ldhl	sp,	#1
    0000004C 22               [ 8]  118 	ld	(hl+), a
    0000004D AF               [ 4]  119 	xor	a, a
    0000004E 32               [ 8]  120 	ld	(hl-), a
    0000004F 2A               [ 8]  121 	ld	a, (hl+)
    00000050 5F               [ 4]  122 	ld	e, a
    00000051 56               [ 8]  123 	ld	d, (hl)
    00000052 21 10 00         [12]  124 	ld	hl, #0x0010
    00000055 7B               [ 4]  125 	ld	a, e
    00000056 95               [ 4]  126 	sub	a, l
    00000057 5F               [ 4]  127 	ld	e, a
    00000058 7A               [ 4]  128 	ld	a, d
    00000059 9C               [ 4]  129 	sbc	a, h
    0000005A F8 04            [12]  130 	ldhl	sp,	#4
    0000005C 32               [ 8]  131 	ld	(hl-), a
    0000005D 73               [ 8]  132 	ld	(hl), e
    0000005E 2A               [ 8]  133 	ld	a, (hl+)
    0000005F 4F               [ 4]  134 	ld	c, a
    00000060 46               [ 8]  135 	ld	b, (hl)
    00000061 CB 7E            [12]  136 	bit	7, (hl)
    00000063 28 0C            [12]  137 	jr	Z, 00104$
    00000065 2B               [ 8]  138 	dec	hl
    00000066 2B               [ 8]  139 	dec	hl
    00000067 2B               [ 8]  140 	dec	hl
    00000068 2A               [ 8]  141 	ld	a, (hl+)
    00000069 5F               [ 4]  142 	ld	e, a
    0000006A 56               [ 8]  143 	ld	d, (hl)
    0000006B 21 F7 FF         [12]  144 	ld	hl, #0xfff7
    0000006E 19               [ 8]  145 	add	hl, de
    0000006F 4D               [ 4]  146 	ld	c, l
    00000070 44               [ 4]  147 	ld	b, h
    00000071                        148 00104$:
    00000071 CB 28            [ 8]  149 	sra	b
    00000073 CB 19            [ 8]  150 	rr	c
    00000075 CB 28            [ 8]  151 	sra	b
    00000077 CB 19            [ 8]  152 	rr	c
    00000079 CB 28            [ 8]  153 	sra	b
    0000007B CB 19            [ 8]  154 	rr	c
                                    155 ;src/Common.c:23: uint16_t tileindexBR = 20 * indexBRy + indexBRx;
    0000007D 06 00            [ 8]  156 	ld	b, #0x00
    0000007F 69               [ 4]  157 	ld	l, c
    00000080 60               [ 4]  158 	ld	h, b
    00000081 29               [ 8]  159 	add	hl, hl
    00000082 29               [ 8]  160 	add	hl, hl
    00000083 09               [ 8]  161 	add	hl, bc
    00000084 29               [ 8]  162 	add	hl, hl
    00000085 29               [ 8]  163 	add	hl, hl
    00000086 4D               [ 4]  164 	ld	c, l
    00000087 44               [ 4]  165 	ld	b, h
    00000088 F8 00            [12]  166 	ldhl	sp,	#0
    0000008A 7E               [ 8]  167 	ld	a, (hl)
    0000008B 1E 00            [ 8]  168 	ld	e, #0x00
    0000008D 81               [ 4]  169 	add	a, c
    0000008E 4F               [ 4]  170 	ld	c, a
    0000008F 7B               [ 4]  171 	ld	a, e
    00000090 88               [ 4]  172 	adc	a, b
    00000091 47               [ 4]  173 	ld	b, a
                                    174 ;src/Common.c:25: return tileindexBR;
                                    175 ;src/Common.c:26: }
    00000092 E8 06            [16]  176 	add	sp, #6
    00000094 C9               [16]  177 	ret
                                    178 ;src/Common.c:29: void change_bkg_tile_xy(uint16_t tile_index, uint8_t tile_id){
                                    179 ;	---------------------------------
                                    180 ; Function change_bkg_tile_xy
                                    181 ; ---------------------------------
    00000095                        182 _change_bkg_tile_xy::
    00000095 3B               [ 8]  183 	dec	sp
    00000096 3B               [ 8]  184 	dec	sp
    00000097 F8 01            [12]  185 	ldhl	sp,	#1
    00000099 77               [ 8]  186 	ld	(hl), a
                                    187 ;src/Common.c:38: uint8_t y = (tile_index / 20);
    0000009A D5               [16]  188 	push	de
    0000009B 01 14 00         [12]  189 	ld	bc, #0x0014
    0000009E CDr00r00         [24]  190 	call	__divuint
    000000A1 D1               [12]  191 	pop	de
    000000A2 F8 00            [12]  192 	ldhl	sp,	#0
    000000A4 71               [ 8]  193 	ld	(hl), c
                                    194 ;src/Common.c:39: uint8_t x = (tile_index % 20);
    000000A5 01 14 00         [12]  195 	ld	bc, #0x0014
    000000A8 CDr00r00         [24]  196 	call	__moduint
                                    197 ;src/Common.c:41: set_bkg_tiles(x-1, y-1, 1, 1, &tile_id);
    000000AB F8 01            [12]  198 	ldhl	sp,	#1
    000000AD 5D               [ 4]  199 	ld	e, l
    000000AE 54               [ 4]  200 	ld	d, h
    000000AF F8 00            [12]  201 	ldhl	sp,	#0
    000000B1 66               [ 8]  202 	ld	h, (hl)
    000000B2 25               [ 4]  203 	dec	h
    000000B3 41               [ 4]  204 	ld	b, c
    000000B4 05               [ 4]  205 	dec	b
    000000B5 E5               [16]  206 	push	hl
    000000B6 D5               [16]  207 	push	de
    000000B7 D5               [16]  208 	push	de
    000000B8 11 01 01         [12]  209 	ld	de, #0x101
    000000BB D5               [16]  210 	push	de
    000000BC 68               [ 4]  211 	ld	l, b
    000000BD E5               [16]  212 	push	hl
    000000BE CDr00r00         [24]  213 	call	_set_bkg_tiles
    000000C1 E8 06            [16]  214 	add	sp, #6
    000000C3 D1               [12]  215 	pop	de
    000000C4 E1               [12]  216 	pop	hl
                                    217 ;src/Common.c:42: set_bkg_tiles(x, y-1, 1, 1, &tile_id);
    000000C5 D5               [16]  218 	push	de
    000000C6 D5               [16]  219 	push	de
    000000C7 11 01 01         [12]  220 	ld	de, #0x101
    000000CA D5               [16]  221 	push	de
    000000CB 69               [ 4]  222 	ld	l, c
    000000CC E5               [16]  223 	push	hl
    000000CD CDr00r00         [24]  224 	call	_set_bkg_tiles
    000000D0 E8 06            [16]  225 	add	sp, #6
    000000D2 D1               [12]  226 	pop	de
                                    227 ;src/Common.c:43: set_bkg_tiles(x-1, y, 1, 1, &tile_id);
    000000D3 D5               [16]  228 	push	de
    000000D4 D5               [16]  229 	push	de
    000000D5 21 01 01         [12]  230 	ld	hl, #0x101
    000000D8 E5               [16]  231 	push	hl
    000000D9 F8 06            [12]  232 	ldhl	sp,	#6
    000000DB 7E               [ 8]  233 	ld	a, (hl)
    000000DC F5               [16]  234 	push	af
    000000DD 33               [ 8]  235 	inc	sp
    000000DE C5               [16]  236 	push	bc
    000000DF 33               [ 8]  237 	inc	sp
    000000E0 CDr00r00         [24]  238 	call	_set_bkg_tiles
    000000E3 E8 06            [16]  239 	add	sp, #6
                                    240 ;src/Common.c:44: set_bkg_tiles(x, y, 1, 1, &tile_id);
    000000E5 21 01 01         [12]  241 	ld	hl, #0x101
    000000E8 E5               [16]  242 	push	hl
    000000E9 F8 04            [12]  243 	ldhl	sp,	#4
    000000EB 7E               [ 8]  244 	ld	a, (hl)
    000000EC F5               [16]  245 	push	af
    000000ED 33               [ 8]  246 	inc	sp
    000000EE 79               [ 4]  247 	ld	a, c
    000000EF F5               [16]  248 	push	af
    000000F0 33               [ 8]  249 	inc	sp
    000000F1 CDr00r00         [24]  250 	call	_set_bkg_tiles
                                    251 ;src/Common.c:45: }
    000000F4 E8 08            [16]  252 	add	sp, #8
    000000F6 C9               [16]  253 	ret
                                    254 ;src/Common.c:47: void change_bkg_tile_16x16(uint16_t tile_index, uint8_t tile_id_BR){
                                    255 ;	---------------------------------
                                    256 ; Function change_bkg_tile_16x16
                                    257 ; ---------------------------------
    000000F7                        258 _change_bkg_tile_16x16::
    000000F7 E8 FB            [16]  259 	add	sp, #-5
    000000F9 F8 04            [12]  260 	ldhl	sp,	#4
    000000FB 77               [ 8]  261 	ld	(hl), a
                                    262 ;src/Common.c:58: uint8_t y = (tile_index / 20);
    000000FC D5               [16]  263 	push	de
    000000FD 01 14 00         [12]  264 	ld	bc, #0x0014
    00000100 CDr00r00         [24]  265 	call	__divuint
    00000103 D1               [12]  266 	pop	de
    00000104 F8 03            [12]  267 	ldhl	sp,	#3
    00000106 71               [ 8]  268 	ld	(hl), c
                                    269 ;src/Common.c:59: uint8_t x = (tile_index % 20);
    00000107 01 14 00         [12]  270 	ld	bc, #0x0014
    0000010A CDr00r00         [24]  271 	call	__moduint
    0000010D 59               [ 4]  272 	ld	e, c
                                    273 ;src/Common.c:61: uint8_t tile_id_TR = tile_id_BR - 0x01;
    0000010E F8 04            [12]  274 	ldhl	sp,	#4
    00000110 4E               [ 8]  275 	ld	c, (hl)
    00000111 79               [ 4]  276 	ld	a, c
    00000112 3D               [ 4]  277 	dec	a
    00000113 F8 00            [12]  278 	ldhl	sp,	#0
                                    279 ;src/Common.c:62: uint8_t tile_id_BL = tile_id_BR - 0x02;
    00000115 22               [ 8]  280 	ld	(hl+), a
    00000116 79               [ 4]  281 	ld	a, c
    00000117 C6 FE            [ 8]  282 	add	a, #0xfe
                                    283 ;src/Common.c:63: uint8_t tile_id_TL = tile_id_BR - 0x03;
    00000119 22               [ 8]  284 	ld	(hl+), a
    0000011A 79               [ 4]  285 	ld	a, c
    0000011B C6 FD            [ 8]  286 	add	a, #0xfd
    0000011D 77               [ 8]  287 	ld	(hl), a
                                    288 ;src/Common.c:65: set_bkg_tiles(x,y,1,1,&tile_id_BR);
    0000011E 21 04 00         [12]  289 	ld	hl, #4
    00000121 39               [ 8]  290 	add	hl, sp
    00000122 D5               [16]  291 	push	de
    00000123 E5               [16]  292 	push	hl
    00000124 21 01 01         [12]  293 	ld	hl, #0x101
    00000127 E5               [16]  294 	push	hl
    00000128 F8 09            [12]  295 	ldhl	sp,	#9
    0000012A 56               [ 8]  296 	ld	d, (hl)
    0000012B D5               [16]  297 	push	de
    0000012C CDr00r00         [24]  298 	call	_set_bkg_tiles
    0000012F E8 06            [16]  299 	add	sp, #6
    00000131 D1               [12]  300 	pop	de
                                    301 ;src/Common.c:66: set_bkg_tiles(x-1,y,1,1,&tile_id_BL);
    00000132 4B               [ 4]  302 	ld	c, e
    00000133 0D               [ 4]  303 	dec	c
    00000134 D5               [16]  304 	push	de
    00000135 21 03 00         [12]  305 	ld	hl, #3
    00000138 39               [ 8]  306 	add	hl, sp
    00000139 E5               [16]  307 	push	hl
    0000013A 21 01 01         [12]  308 	ld	hl, #0x101
    0000013D E5               [16]  309 	push	hl
    0000013E F8 09            [12]  310 	ldhl	sp,	#9
    00000140 46               [ 8]  311 	ld	b, (hl)
    00000141 C5               [16]  312 	push	bc
    00000142 CDr00r00         [24]  313 	call	_set_bkg_tiles
    00000145 E8 06            [16]  314 	add	sp, #6
    00000147 D1               [12]  315 	pop	de
                                    316 ;src/Common.c:67: set_bkg_tiles(x,y-1,1,1,&tile_id_TR);
    00000148 F8 03            [12]  317 	ldhl	sp,	#3
    0000014A 46               [ 8]  318 	ld	b, (hl)
    0000014B 05               [ 4]  319 	dec	b
    0000014C 21 00 00         [12]  320 	ld	hl, #0
    0000014F 39               [ 8]  321 	add	hl, sp
    00000150 E5               [16]  322 	push	hl
    00000151 21 01 01         [12]  323 	ld	hl, #0x101
    00000154 E5               [16]  324 	push	hl
    00000155 C5               [16]  325 	push	bc
    00000156 33               [ 8]  326 	inc	sp
    00000157 7B               [ 4]  327 	ld	a, e
    00000158 F5               [16]  328 	push	af
    00000159 33               [ 8]  329 	inc	sp
    0000015A CDr00r00         [24]  330 	call	_set_bkg_tiles
    0000015D E8 06            [16]  331 	add	sp, #6
                                    332 ;src/Common.c:68: set_bkg_tiles(x-1,y-1,1,1,&tile_id_TL);
    0000015F 21 02 00         [12]  333 	ld	hl, #2
    00000162 39               [ 8]  334 	add	hl, sp
    00000163 E5               [16]  335 	push	hl
    00000164 21 01 01         [12]  336 	ld	hl, #0x101
    00000167 E5               [16]  337 	push	hl
    00000168 C5               [16]  338 	push	bc
    00000169 33               [ 8]  339 	inc	sp
    0000016A 79               [ 4]  340 	ld	a, c
    0000016B F5               [16]  341 	push	af
    0000016C 33               [ 8]  342 	inc	sp
    0000016D CDr00r00         [24]  343 	call	_set_bkg_tiles
                                    344 ;src/Common.c:70: }
    00000170 E8 0B            [16]  345 	add	sp, #11
    00000172 C9               [16]  346 	ret
                                    347 	.area _CODE
                                    348 	.area _INITIALIZER
                                    349 	.area _CABS (ABS)
