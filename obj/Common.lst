                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module Common
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _set_bkg_tiles
                                     11 	.globl _wait_vbl_done
                                     12 	.globl _performantdelay
                                     13 	.globl _tileindex_from_xy
                                     14 	.globl _change_bkg_tile_xy
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 ;--------------------------------------------------------
                                     19 ; ram data
                                     20 ;--------------------------------------------------------
                                     21 	.area _DATA
                                     22 ;--------------------------------------------------------
                                     23 ; ram data
                                     24 ;--------------------------------------------------------
                                     25 	.area _INITIALIZED
                                     26 ;--------------------------------------------------------
                                     27 ; absolute external ram data
                                     28 ;--------------------------------------------------------
                                     29 	.area _DABS (ABS)
                                     30 ;--------------------------------------------------------
                                     31 ; global & static initialisations
                                     32 ;--------------------------------------------------------
                                     33 	.area _HOME
                                     34 	.area _GSINIT
                                     35 	.area _GSFINAL
                                     36 	.area _GSINIT
                                     37 ;--------------------------------------------------------
                                     38 ; Home
                                     39 ;--------------------------------------------------------
                                     40 	.area _HOME
                                     41 	.area _HOME
                                     42 ;--------------------------------------------------------
                                     43 ; code
                                     44 ;--------------------------------------------------------
                                     45 	.area _CODE
                                     46 ;src/Common.c:5: void performantdelay(uint8_t numloops){
                                     47 ;	---------------------------------
                                     48 ; Function performantdelay
                                     49 ; ---------------------------------
    00000000                         50 _performantdelay::
    00000000 4F               [ 4]   51 	ld	c, a
                                     52 ;src/Common.c:7: for(i = 0; i < numloops; i++){
    00000001 06 00            [ 8]   53 	ld	b, #0x00
    00000003                         54 00103$:
    00000003 78               [ 4]   55 	ld	a, b
    00000004 91               [ 4]   56 	sub	a, c
    00000005 D0               [20]   57 	ret	NC
                                     58 ;src/Common.c:8: wait_vbl_done();
    00000006 CDr00r00         [24]   59 	call	_wait_vbl_done
                                     60 ;src/Common.c:7: for(i = 0; i < numloops; i++){
    00000009 04               [ 4]   61 	inc	b
                                     62 ;src/Common.c:10: }
    0000000A 18 F7            [12]   63 	jr	00103$
                                     64 ;src/Common.c:12: uint16_t tileindex_from_xy(uint8_t x, uint8_t y){
                                     65 ;	---------------------------------
                                     66 ; Function tileindex_from_xy
                                     67 ; ---------------------------------
    0000000C                         68 _tileindex_from_xy::
    0000000C E8 FA            [16]   69 	add	sp, #-6
    0000000E F8 05            [12]   70 	ldhl	sp,	#5
    00000010 73               [ 8]   71 	ld	(hl), e
                                     72 ;src/Common.c:21: uint8_t indexBRx = (x - 8) / 8; //señala la columna
    00000011 F8 01            [12]   73 	ldhl	sp,	#1
    00000013 22               [ 8]   74 	ld	(hl+), a
    00000014 AF               [ 4]   75 	xor	a, a
    00000015 32               [ 8]   76 	ld	(hl-), a
    00000016 2A               [ 8]   77 	ld	a, (hl+)
    00000017 5F               [ 4]   78 	ld	e, a
    00000018 56               [ 8]   79 	ld	d, (hl)
    00000019 21 08 00         [12]   80 	ld	hl, #0x0008
    0000001C 7B               [ 4]   81 	ld	a, e
    0000001D 95               [ 4]   82 	sub	a, l
    0000001E 5F               [ 4]   83 	ld	e, a
    0000001F 7A               [ 4]   84 	ld	a, d
    00000020 9C               [ 4]   85 	sbc	a, h
    00000021 F8 04            [12]   86 	ldhl	sp,	#4
    00000023 32               [ 8]   87 	ld	(hl-), a
    00000024 73               [ 8]   88 	ld	(hl), e
    00000025 2A               [ 8]   89 	ld	a, (hl+)
    00000026 4F               [ 4]   90 	ld	c, a
    00000027 46               [ 8]   91 	ld	b, (hl)
    00000028 CB 7E            [12]   92 	bit	7, (hl)
    0000002A 28 0C            [12]   93 	jr	Z, 00103$
    0000002C 2B               [ 8]   94 	dec	hl
    0000002D 2B               [ 8]   95 	dec	hl
    0000002E 2B               [ 8]   96 	dec	hl
    0000002F 2A               [ 8]   97 	ld	a, (hl+)
    00000030 5F               [ 4]   98 	ld	e, a
    00000031 56               [ 8]   99 	ld	d, (hl)
    00000032 21 FF FF         [12]  100 	ld	hl, #0xffff
    00000035 19               [ 8]  101 	add	hl, de
    00000036 4D               [ 4]  102 	ld	c, l
    00000037 44               [ 4]  103 	ld	b, h
    00000038                        104 00103$:
    00000038 CB 28            [ 8]  105 	sra	b
    0000003A CB 19            [ 8]  106 	rr	c
    0000003C CB 28            [ 8]  107 	sra	b
    0000003E CB 19            [ 8]  108 	rr	c
    00000040 CB 28            [ 8]  109 	sra	b
    00000042 CB 19            [ 8]  110 	rr	c
    00000044 F8 00            [12]  111 	ldhl	sp,	#0
    00000046 71               [ 8]  112 	ld	(hl), c
                                    113 ;src/Common.c:22: uint8_t indexBRy = (y - 16) / 8; //señala la fila
    00000047 F8 05            [12]  114 	ldhl	sp,	#5
    00000049 7E               [ 8]  115 	ld	a, (hl)
    0000004A F8 01            [12]  116 	ldhl	sp,	#1
    0000004C 22               [ 8]  117 	ld	(hl+), a
    0000004D AF               [ 4]  118 	xor	a, a
    0000004E 32               [ 8]  119 	ld	(hl-), a
    0000004F 2A               [ 8]  120 	ld	a, (hl+)
    00000050 5F               [ 4]  121 	ld	e, a
    00000051 56               [ 8]  122 	ld	d, (hl)
    00000052 21 10 00         [12]  123 	ld	hl, #0x0010
    00000055 7B               [ 4]  124 	ld	a, e
    00000056 95               [ 4]  125 	sub	a, l
    00000057 5F               [ 4]  126 	ld	e, a
    00000058 7A               [ 4]  127 	ld	a, d
    00000059 9C               [ 4]  128 	sbc	a, h
    0000005A F8 04            [12]  129 	ldhl	sp,	#4
    0000005C 32               [ 8]  130 	ld	(hl-), a
    0000005D 73               [ 8]  131 	ld	(hl), e
    0000005E 2A               [ 8]  132 	ld	a, (hl+)
    0000005F 4F               [ 4]  133 	ld	c, a
    00000060 46               [ 8]  134 	ld	b, (hl)
    00000061 CB 7E            [12]  135 	bit	7, (hl)
    00000063 28 0C            [12]  136 	jr	Z, 00104$
    00000065 2B               [ 8]  137 	dec	hl
    00000066 2B               [ 8]  138 	dec	hl
    00000067 2B               [ 8]  139 	dec	hl
    00000068 2A               [ 8]  140 	ld	a, (hl+)
    00000069 5F               [ 4]  141 	ld	e, a
    0000006A 56               [ 8]  142 	ld	d, (hl)
    0000006B 21 F7 FF         [12]  143 	ld	hl, #0xfff7
    0000006E 19               [ 8]  144 	add	hl, de
    0000006F 4D               [ 4]  145 	ld	c, l
    00000070 44               [ 4]  146 	ld	b, h
    00000071                        147 00104$:
    00000071 CB 28            [ 8]  148 	sra	b
    00000073 CB 19            [ 8]  149 	rr	c
    00000075 CB 28            [ 8]  150 	sra	b
    00000077 CB 19            [ 8]  151 	rr	c
    00000079 CB 28            [ 8]  152 	sra	b
    0000007B CB 19            [ 8]  153 	rr	c
                                    154 ;src/Common.c:23: uint16_t tileindexBR = 20 * indexBRy + indexBRx;
    0000007D 06 00            [ 8]  155 	ld	b, #0x00
    0000007F 69               [ 4]  156 	ld	l, c
    00000080 60               [ 4]  157 	ld	h, b
    00000081 29               [ 8]  158 	add	hl, hl
    00000082 29               [ 8]  159 	add	hl, hl
    00000083 09               [ 8]  160 	add	hl, bc
    00000084 29               [ 8]  161 	add	hl, hl
    00000085 29               [ 8]  162 	add	hl, hl
    00000086 4D               [ 4]  163 	ld	c, l
    00000087 44               [ 4]  164 	ld	b, h
    00000088 F8 00            [12]  165 	ldhl	sp,	#0
    0000008A 7E               [ 8]  166 	ld	a, (hl)
    0000008B 1E 00            [ 8]  167 	ld	e, #0x00
    0000008D 81               [ 4]  168 	add	a, c
    0000008E 4F               [ 4]  169 	ld	c, a
    0000008F 7B               [ 4]  170 	ld	a, e
    00000090 88               [ 4]  171 	adc	a, b
    00000091 47               [ 4]  172 	ld	b, a
                                    173 ;src/Common.c:25: return tileindexBR;
                                    174 ;src/Common.c:26: }
    00000092 E8 06            [16]  175 	add	sp, #6
    00000094 C9               [16]  176 	ret
                                    177 ;src/Common.c:29: void change_bkg_tile_xy(uint16_t tile_index, uint8_t tile_id){
                                    178 ;	---------------------------------
                                    179 ; Function change_bkg_tile_xy
                                    180 ; ---------------------------------
    00000095                        181 _change_bkg_tile_xy::
    00000095 3B               [ 8]  182 	dec	sp
    00000096 3B               [ 8]  183 	dec	sp
    00000097 F8 01            [12]  184 	ldhl	sp,	#1
    00000099 77               [ 8]  185 	ld	(hl), a
                                    186 ;src/Common.c:38: uint8_t y = (tile_index / 20);
    0000009A D5               [16]  187 	push	de
    0000009B 01 14 00         [12]  188 	ld	bc, #0x0014
    0000009E CDr00r00         [24]  189 	call	__divuint
    000000A1 D1               [12]  190 	pop	de
    000000A2 F8 00            [12]  191 	ldhl	sp,	#0
    000000A4 71               [ 8]  192 	ld	(hl), c
                                    193 ;src/Common.c:39: uint8_t x = (tile_index % 20);
    000000A5 01 14 00         [12]  194 	ld	bc, #0x0014
    000000A8 CDr00r00         [24]  195 	call	__moduint
                                    196 ;src/Common.c:40: set_bkg_tiles(x-1, y-1, 1, 1, &tile_id);
    000000AB F8 01            [12]  197 	ldhl	sp,	#1
    000000AD 5D               [ 4]  198 	ld	e, l
    000000AE 54               [ 4]  199 	ld	d, h
    000000AF F8 00            [12]  200 	ldhl	sp,	#0
    000000B1 66               [ 8]  201 	ld	h, (hl)
    000000B2 25               [ 4]  202 	dec	h
    000000B3 41               [ 4]  203 	ld	b, c
    000000B4 05               [ 4]  204 	dec	b
    000000B5 E5               [16]  205 	push	hl
    000000B6 D5               [16]  206 	push	de
    000000B7 D5               [16]  207 	push	de
    000000B8 11 01 01         [12]  208 	ld	de, #0x101
    000000BB D5               [16]  209 	push	de
    000000BC 68               [ 4]  210 	ld	l, b
    000000BD E5               [16]  211 	push	hl
    000000BE CDr00r00         [24]  212 	call	_set_bkg_tiles
    000000C1 E8 06            [16]  213 	add	sp, #6
    000000C3 D1               [12]  214 	pop	de
    000000C4 E1               [12]  215 	pop	hl
                                    216 ;src/Common.c:41: set_bkg_tiles(x, y-1, 1, 1, &tile_id);
    000000C5 D5               [16]  217 	push	de
    000000C6 D5               [16]  218 	push	de
    000000C7 11 01 01         [12]  219 	ld	de, #0x101
    000000CA D5               [16]  220 	push	de
    000000CB 69               [ 4]  221 	ld	l, c
    000000CC E5               [16]  222 	push	hl
    000000CD CDr00r00         [24]  223 	call	_set_bkg_tiles
    000000D0 E8 06            [16]  224 	add	sp, #6
    000000D2 D1               [12]  225 	pop	de
                                    226 ;src/Common.c:42: set_bkg_tiles(x-1, y, 1, 1, &tile_id);
    000000D3 D5               [16]  227 	push	de
    000000D4 D5               [16]  228 	push	de
    000000D5 21 01 01         [12]  229 	ld	hl, #0x101
    000000D8 E5               [16]  230 	push	hl
    000000D9 F8 06            [12]  231 	ldhl	sp,	#6
    000000DB 7E               [ 8]  232 	ld	a, (hl)
    000000DC F5               [16]  233 	push	af
    000000DD 33               [ 8]  234 	inc	sp
    000000DE C5               [16]  235 	push	bc
    000000DF 33               [ 8]  236 	inc	sp
    000000E0 CDr00r00         [24]  237 	call	_set_bkg_tiles
    000000E3 E8 06            [16]  238 	add	sp, #6
                                    239 ;src/Common.c:43: set_bkg_tiles(x, y, 1, 1, &tile_id);
    000000E5 21 01 01         [12]  240 	ld	hl, #0x101
    000000E8 E5               [16]  241 	push	hl
    000000E9 F8 04            [12]  242 	ldhl	sp,	#4
    000000EB 7E               [ 8]  243 	ld	a, (hl)
    000000EC F5               [16]  244 	push	af
    000000ED 33               [ 8]  245 	inc	sp
    000000EE 79               [ 4]  246 	ld	a, c
    000000EF F5               [16]  247 	push	af
    000000F0 33               [ 8]  248 	inc	sp
    000000F1 CDr00r00         [24]  249 	call	_set_bkg_tiles
                                    250 ;src/Common.c:44: }
    000000F4 E8 08            [16]  251 	add	sp, #8
    000000F6 C9               [16]  252 	ret
                                    253 	.area _CODE
                                    254 	.area _INITIALIZER
                                    255 	.area _CABS (ABS)
